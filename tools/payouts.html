<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ion Mining Group â€” Payouts</title>
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="./shared.css?v=49">
    <script>
    if (!localStorage.getItem('sw_clean_v49') && 'serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(r) {
            var p = r.map(function(x) { return x.unregister(); });
            p.push(caches.keys().then(function(k) { return Promise.all(k.map(function(n) { return caches.delete(n); })); }));
            Promise.all(p).then(function() { localStorage.setItem('sw_clean_v49', '1'); location.reload(); });
        });
    }
    </script>
    <script src="./chart.min.js?v=49"></script>
</head>
<body>
<canvas id="techLinesCanvas"></canvas>

<nav id="ion-nav"></nav>

<main>

    <!-- ===== EARNINGS SUMMARY ===== -->
    <div class="section-label">Earnings Summary</div>
    <section class="fleet-grid">
        <div class="metric-card">
            <div class="label">Total BTC Earned</div>
            <div class="value btc-orange" id="sumTotalEarned">--</div>
            <div class="sub">all-time logged</div>
        </div>
        <div class="metric-card">
            <div class="label">Total USD Value</div>
            <div class="value neutral" id="sumTotalUSD">--</div>
            <div class="sub" id="sumAvgPrice">--</div>
        </div>
        <div class="metric-card">
            <div class="label">Avg Daily Earnings</div>
            <div class="value btc-orange" id="sumAvgDaily">--</div>
            <div class="sub">BTC per day</div>
        </div>
        <div class="metric-card">
            <div class="label">Total Payouts</div>
            <div class="value positive" id="sumTotalPayouts">--</div>
            <div class="sub" id="sumPayoutBTC">--</div>
        </div>
        <div class="metric-card">
            <div class="label">Last Snapshot</div>
            <div class="value neutral" id="sumLastSnapshot">--</div>
            <div class="sub" id="sumSnapshotDate">--</div>
        </div>
    </section>

    <!-- ===== ACTION BUTTONS ===== -->
    <div class="dashboard-actions">
        <button class="btn btn-primary" id="btnAddPayout">+ Add Payout</button>
        <button class="btn btn-secondary" id="btnExportCSV">Export CSV</button>
    </div>

    <div id="f2poolSyncStatus" style="text-align:center; color:#555; font-size:12px; margin-top:8px;"></div>

    <!-- ===== ELECTRICITY COST SUMMARY ===== -->
    <div class="section-label">Electricity Costs</div>
    <section class="fleet-grid">
        <div class="metric-card">
            <div class="label">Total Electricity Cost</div>
            <div class="value negative" id="elecTotalCost">--</div>
            <div class="sub">all-time</div>
        </div>
        <div class="metric-card">
            <div class="label">Avg Monthly Cost</div>
            <div class="value neutral" id="elecAvgMonthly">--</div>
            <div class="sub">per month</div>
        </div>
        <div class="metric-card">
            <div class="label">Total kWh Consumed</div>
            <div class="value neutral" id="elecTotalKWh">--</div>
            <div class="sub">all-time</div>
        </div>
        <div class="metric-card">
            <div class="label">Effective $/kWh</div>
            <div class="value neutral" id="elecEffRate">--</div>
            <div class="sub">weighted average</div>
        </div>
    </section>

    <div class="dashboard-actions">
        <button class="btn btn-primary" id="btnAddBill">+ Add Bill</button>
        <button class="btn btn-secondary" id="btnEstimateFleet">Estimate from Fleet</button>
    </div>

    <!-- Add Bill Slide Panel -->
    <div class="slide-panel" id="addBillPanel">
        <div class="panel-inner">
            <h4>Add Electricity Bill</h4>
            <div class="panel-form-grid">
                <div class="input-group">
                    <label>Date</label>
                    <div class="input-wrapper">
                        <input type="date" id="fbDate">
                    </div>
                </div>
                <div class="input-group">
                    <label>kWh Used</label>
                    <div class="input-wrapper">
                        <input type="number" id="fbKwh" placeholder="1500" min="0" step="1">
                        <span class="suffix">kWh</span>
                    </div>
                </div>
                <div class="input-group">
                    <label>Total Cost</label>
                    <div class="input-wrapper">
                        <span class="prefix">$</span>
                        <input type="number" id="fbCost" placeholder="150.00" min="0" step="0.01">
                    </div>
                </div>
                <div class="input-group">
                    <label>Notes (optional)</label>
                    <div class="input-wrapper">
                        <input type="text" id="fbNotes" placeholder="e.g. January electric bill">
                    </div>
                </div>
            </div>
            <div class="panel-actions">
                <button class="btn btn-secondary" id="cancelBill">Cancel</button>
                <button class="btn btn-primary" id="saveBill">Save Bill</button>
            </div>
        </div>
    </div>

    <!-- ===== ELECTRICITY LOG TABLE ===== -->
    <div class="card">
        <h3>Electricity Log</h3>
        <div class="table-scroll">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>kWh</th>
                        <th>Cost</th>
                        <th>$/kWh</th>
                        <th>Notes</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="elecTableBody">
                    <tr><td colspan="6" style="text-align:center; padding:20px; color:#555;">No electricity bills logged yet</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Payout Slide Panel -->
    <div class="slide-panel" id="addPayoutPanel">
        <div class="panel-inner">
            <h4>Add Payout Entry</h4>
            <div class="panel-form-grid">
                <div class="input-group">
                    <label>Date</label>
                    <div class="input-wrapper">
                        <input type="date" id="fpDate">
                    </div>
                </div>
                <div class="input-group">
                    <label>BTC Amount</label>
                    <div class="input-wrapper">
                        <input type="number" id="fpBtcAmount" placeholder="0.01234567" min="0" step="0.00000001">
                        <span class="suffix">BTC</span>
                    </div>
                </div>
                <div class="input-group">
                    <label>BTC Price (optional)</label>
                    <div class="input-wrapper">
                        <span class="prefix">$</span>
                        <input type="number" id="fpBtcPrice" placeholder="auto-filled if left blank" min="0" step="100">
                    </div>
                </div>
                <div class="input-group">
                    <label>TX Hash (optional)</label>
                    <div class="input-wrapper">
                        <input type="text" id="fpTxHash" placeholder="Transaction hash">
                    </div>
                </div>
                <div class="input-group">
                    <label>Notes (optional)</label>
                    <div class="input-wrapper">
                        <input type="text" id="fpNotes" placeholder="e.g. F2Pool weekly payout">
                    </div>
                </div>
            </div>
            <div class="panel-actions">
                <button class="btn btn-secondary" id="cancelPayout">Cancel</button>
                <button class="btn btn-primary" id="savePayout">Save Payout</button>
            </div>
        </div>
    </div>

    <!-- Export Options Slide Panel -->
    <div class="slide-panel" id="exportPanel">
        <div class="panel-inner">
            <h4>Export CSV for Tax Reporting</h4>
            <div class="panel-form-grid">
                <div class="input-group">
                    <label>Year Preset</label>
                    <div class="input-wrapper">
                        <select id="exYearPreset">
                            <option value="">Custom Range</option>
                            <option value="2026">2026 Tax Year</option>
                            <option value="2025">2025 Tax Year</option>
                            <option value="2024">2024 Tax Year</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label>Start Date</label>
                    <div class="input-wrapper">
                        <input type="date" id="exStartDate">
                    </div>
                </div>
                <div class="input-group">
                    <label>End Date</label>
                    <div class="input-wrapper">
                        <input type="date" id="exEndDate">
                    </div>
                </div>
            </div>
            <div class="panel-actions">
                <button class="btn btn-secondary" id="cancelExport">Cancel</button>
                <button class="btn btn-primary" id="downloadCSV">Download CSV</button>
            </div>
        </div>
    </div>

    <!-- ===== PAYOUT LOG TABLE ===== -->
    <div class="card">
        <h3>Payout Log</h3>
        <div class="table-scroll">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>BTC Amount</th>
                        <th>BTC Price</th>
                        <th>USD Value</th>
                        <th>TX Hash</th>
                        <th>Notes</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="payoutTableBody">
                    <tr><td colspan="7" style="text-align:center; padding:20px; color:#555;">No payouts logged yet</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ===== EARNINGS OVER TIME CHART ===== -->
    <div class="card">
        <h3>Cumulative Payouts Over Time</h3>
        <div class="earnings-chart-container" style="position:relative;">
            <div id="chartEmptyMsg" style="position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; color:#555; z-index:2;">Add payouts to see the chart</div>
            <canvas id="earningsOverTimeChart"></canvas>
        </div>
    </div>

    <!-- ===== REVENUE VS COSTS CHART ===== -->
    <div class="card">
        <h3>Revenue vs Electricity Costs</h3>
        <div class="earnings-chart-container" style="position:relative;">
            <div id="revCostEmptyMsg" style="position:absolute; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; color:#555; z-index:2;">Add payouts and electricity bills to see the chart</div>
            <canvas id="revVsCostChart"></canvas>
        </div>
    </div>

</main>

<footer>
    Ion Mining Group &mdash; Payout Tracking<br>
    <span style="font-size:11px; color:#555;">Track earnings for tax reporting. Not financial advice.</span>
</footer>

<script src="./shared.js?v=49"></script>
<script src="./fleet-data.js?v=49"></script>
<script src="./payouts.js?v=49"></script>
<script src="./alerts.js?v=49"></script>
</body>
</html>
